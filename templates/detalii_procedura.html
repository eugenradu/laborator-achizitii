{% extends 'base.html' %}

{% block content %}
<h2>Detalii Procedură: {{ procedura.Nume_Procedura }}</h2>
<p>ID Procedură: <strong>#{{ procedura.ID_Procedura }}</strong></p>
<p>Tip: <strong>{{ procedura.Tip_Procedura.value }}</strong></p>
<p>Stare: <strong>{{ procedura.Stare }}</strong></p>
<p>Data Creare: <strong>{{ procedura.Data_Creare.strftime('%d-%m-%Y') }}</strong></p>
<p>Creat de: <strong>{{ procedura.creator_procedura.Nume_Utilizator if procedura.creator_procedura else 'N/A'
        }}</strong></p>

<div class="actions">
    <a href="{{ url_for('proceduri.genereaza_documentatie', procedura_id=procedura.ID_Procedura) }}"
        class="button-secondary">Generează Documentație (.txt)</a>
</div>

<h3>Loturi Incluse în Procedură</h3>

{% for lot_id, detalii in detalii_loturi.items() %}
<div class="lot-container">
    <h4>Lot #{{ detalii.lot_obj.ID_Lot }}: {{ detalii.lot_obj.Nume_Lot }}</h4>
    <p>
        <small>
            (Provenit din
            <a href="{{ url_for('referate.detalii_referat', referat_id=detalii.lot_obj.referat_parinte.ID_Referat) }}">
                Referat #{{ detalii.lot_obj.referat_parinte.ID_Referat }}
            </a>)
        </small>
    </p>
    {% if detalii.lot_obj.Descriere_Lot %}<p>Descriere: <span class="pre-formatted-text">{{
            detalii.lot_obj.Descriere_Lot }}</span></p>{% endif %}

    <h5>Produse în Acest Lot</h5>
    <table>
        <thead>
            <tr>
                <th>Nume Generic Produs</th>
                <th>Cantitate Solicitată</th>
                <th>Unitate Măsură</th>
            </tr>
        </thead>
        <tbody>
            {% for prod, pir in detalii.produse %}
            <tr>
                <td>{{ prod.Nume_Generic }}</td>
                <td>{{ pir.Cantitate_Solicitata }}</td>
                <td>{{ prod.Unitate_Masura }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="3">Acest lot nu conține produse.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p>Această procedură nu are loturi asociate.</p>
{% endfor %}

<h3>Oferte Primite pentru Această Procedură</h3>
<div class="actions" style="margin-bottom: 15px;">
    <a href="{{ url_for('oferte.adauga_oferta', procedura_id=procedura.ID_Procedura) }}" class="button">Adaugă Ofertă
        pentru Această Procedură</a>
</div>
<table>
    <thead>
        <tr>
            <th>ID Ofertă</th>
            <th>Furnizor</th>
            <th>Data Ofertei</th>
            <th>Nr. Articole</th>
            <th>Acțiuni</th>
        </tr>
    </thead>
    <tbody>
        {% for oferta in oferte_asociate %}
        <tr>
            <td>#{{ oferta.ID_Oferta }}</td>
            <td>{{ oferta.furnizor.Nume_Furnizor }}</td>
            <td>{{ oferta.Data_Oferta.strftime('%d-%m-%Y') }}</td>
            <td>{{ oferta.articole|length }}</td>
            <td>
                <a href="{{ url_for('oferte.detalii_oferta', oferta_id=oferta.ID_Oferta) }}">Vezi Detalii Ofertă</a>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="5">Nicio ofertă nu a fost asociată cu această procedură încă.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<style>
    .lot-container {
        border: 1px solid #ccc;
        padding: 15px;
        margin-top: 20px;
        border-radius: 8px;
    }
</style>
{% endblock %}